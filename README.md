# lean4-logic
Formalizing Logic in Lean4

https://iehality.github.io/lean4-logic/

## Table of Contents

- [lean4-logic](#lean4-logic)
  - [Table of Contents](#table-of-contents)
  - [Usage](#usage)
  - [Structure](#structure)
  - [Classical Propositional Logic](#classical-propositional-logic)
    - [Definition](#definition)
    - [Theorem](#theorem)
  - [Intuitionistic Propositional Logic](#intuitionistic-propositional-logic)
    - [Definitions](#definitions)
    - [Kripkean Semantics](#kripkean-semantics)
      - [Defininitions](#defininitions)
      - [Theorems](#theorems)
  - [First-Order Logic](#first-order-logic)
    - [Definition](#definition-1)
    - [Theorem](#theorem-1)
  - [Normal Modal Logic](#normal-modal-logic)
    - [Definition](#definition-2)
    - [Theorem](#theorem-2)
  - [References](#references)

## Usage
  Add following to `lakefile.lean`.
  ```lean
  require logic from git "https://github.com/iehality/lean4-logic"
  ```

## Structure

The key results are summarised in `Logic/Summary.lean`.

- **Logic**
  - **Vorspiel**: Supplementary definitions and theorems for Mathlib
  - **Logic**
  - **AutoProver**: Automated theorem proving based on proof search
  - **Propositional**: Propositional logic
    - **Classical**: Classical propositional logic
      - **Basic**
    - **Intuitionistic**: Intuitionistic propositional logic
      - **Kriple**: Kripke semantics
  - **FirstOrder**: First-order logic
    - **Basic**
    - **Computability**: encodeing, computability
    - **Completeness**: Completeness theorem
    - **Arith**: Arithmetic
    - **Incompleteness**: Incompleteness theorem
  - **Modal**: Variants of modal logics
    - **Normal**: Normal propositional modal logic

## Classical Propositional Logic

### Definition

|                                     |                                     | Definition                    | Notation |
| :----:                              | ----                                | ----                          | :----:   |
| $(\rm Cut)\vdash_\mathrm{T} \Gamma$ | Derivation in Tait-Calculus + Cut   | [LO.Propositional.Classical.Derivation](https://iehality.github.io/lean4-logic/Logic/Propositional/Classical/Basic/Calculus.html#LO.Propositional.Classical.Derivation) | `‚ä¢¬π Œì`   |
| $v \models p$                       | Tarski's truth definition condition | [LO.Propositional.Classical.semantics](https://iehality.github.io/lean4-logic/Logic/Propositional/Classical/Basic/Semantics.html#LO.Propositional.Classical.semantics) | `v ‚äß p`  |

### Theorem

- [Soundness theorem](https://iehality.github.io/lean4-logic/Logic/Propositional/Classical/Basic/Completeness.html#LO.Propositional.Classical.soundness)
  ```lean
  theorem LO.Propositional.Classical.soundness
    {Œ± : Type u_1}
    {T : LO.Propositional.Theory Œ±}
    {p : LO.Propositional.Formula Œ±} :
    T ‚ä¢ p ‚Üí T ‚ä® p
  ```

- [Completeness theorem](https://iehality.github.io/lean4-logic/Logic/Propositional/Classical/Basic/Completeness.html#LO.Propositional.Classical.completeness)
  ```lean
  noncomputable def LO.Propositional.Classical.completeness
      {Œ± : Type u_1}
      {T : LO.Propositional.Theory Œ±}
      {p : LO.Propositional.Formula Œ±} :
      T ‚ä® p ‚Üí T ‚ä¢ p
  ```

## Intuitionistic Propositional Logic

### Definitions

|                                   |                                            | Definition                                 |   Notation   |
| :-------------------------------: | ------------------------------------------ | :----------------------------------------- | :----------: |
| $\Gamma \vdash \varphi$       | Deduction„ÄÄ | LO.Propositional.Intuitionistic.Deduction | `Œì ‚ä¢‚Å± p` |
| | Deductive (Exists deduction) | LO.Propositional.Intuitionistic.Deductive | `Œì ‚ä¢‚Å±! p` |

### Kripkean Semantics

#### Defininitions

|                                   |                                            | Definition                                 |   Notation   |
| :-------------------------------: | ------------------------------------------ | :----------------------------------------- | :----------: |
| $w \Vdash^M \varphi$       | Satisfy on Kripkean Model $M$ and its world $w$„ÄÄ | LO.Propositional.Intuitionistic.Formula.KripkeSatisfies | `w ‚ä©[M] p` |
| $M \vDash \varphi$        | Models                    | LO.Propositional.Intuitionistic.Formula.KripkeModels |  `M ‚äß p`  |
| $\Gamma \models \varphi$        | Conequences                    | LO.Propositional.Intuitionistic.Formula.KripkeConsequence |  `Œì ‚ä®‚Å± p`  |

#### Theorems
- [Soundness](https://iehality.github.io/lean4-logic/Logic/Propositional/Intuitionistic/Kripke/Soundness.html#LO.Propositional.Intuitionistic.Kripke.sounds)
  ```lean
  theorem Kripke.sounds {Œì : Theory Œ≤} {p : Formula Œ≤} : (Œì ‚ä¢‚Å±! p) ‚Üí (Œì ‚ä®‚Å± p)
  ```
- [Completeness](https://iehality.github.io/lean4-logic/Logic/Propositional/Intuitionistic/Kripke/Completeness.html#LO.Propositional.Intuitionistic.Kripke.completes)
  ```lean
  theorem Kripke.completes
    [DecidableEq Œ≤] [Encodable Œ≤]
    {Œì : Theory Œ≤} {p : Formula Œ≤} : (Œì ‚ä®‚Å± p) ‚Üí (Œì ‚ä¢‚Å±! p)
  ```
- [Disjunction Property](https://iehality.github.io/lean4-logic/Logic/Propositional/Intuitionistic/Kripke/Completeness.html#LO.Propositional.Intuitionistic.Deduction.disjunctive)
  ```lean
  theorem Deduction.disjunctive
    [DecidableEq Œ≤] [Encodable Œ≤]
    {p q : Formula Œ≤} : (‚àÖ ‚ä¢‚Å±! p ‚ãé q) ‚Üí (‚àÖ ‚ä¢‚Å±! p) ‚à® (‚àÖ ‚ä¢‚Å±! q)
  ```

## First-Order Logic

### Definition
|                                     |                                                | Definition                 | Notation |
| :----:                              | ----                                           | ----                       | :----:   |
| $(\rm Cut)\vdash_\mathrm{T} \Gamma$ | Derivation in Tait-Calculus + Cut              | [LO.FirstOrder.Derivation](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Basic/Calculus.html#LO.FirstOrder.Derivation) | `‚ä¢¬π Œì`   |
| $M \models \sigma$                  | Tarski's truth definition condition            | [LO.FirstOrder.Models](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Basic/Semantics/Semantics.html#LO.FirstOrder.Models) | `M ‚äß‚Çò œÉ` |
| $T \triangleright U$                | Theory interpretation                          | [LO.FirstOrder.TheoryInterpretation](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Interpretation.html#LO.FirstOrder.TheoryInterpretation) | `T ‚ä≥ U` |
| $\mathbf{EQ}$                       | Axiom of equality                              | [LO.FirstOrder.Theory.eqAxiom](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Basic/Eq.html#LO.FirstOrder.Theory.eqAxiom) | `ùêÑùêê` |
| $\mathbf{PA^-}$                     | Finitely axiomatized fragment of $\mathbf{PA}$ | [LO.FirstOrder.Arith.Theory.peanoMinus](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Arith/Theory.html#LO.FirstOrder.Arith.Theory.peanoMinus) | `ùêèùêÄ‚Åª` |
| $\mathbf{I}_\mathrm{open}$          | Induction of open formula                      | [LO.FirstOrder.Arith.Theory.iOpen](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Arith/Theory.html#LO.FirstOrder.Arith.Theory.iOpen) | `ùêàopen` |
| $\mathbf{I\Sigma}_n$                | Induction of $\Sigma_n$ formula                | [LO.FirstOrder.Arith.Theory.iSigma](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Arith/Theory.html#LO.FirstOrder.Arith.Theory.iSigma) | `ùêàùö∫` |
| $\mathbf{PA}$                       | Peano arithmetic                               | [LO.FirstOrder.Arith.Theory.peano](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Arith/Theory.html#LO.FirstOrder.Arith.Theory.peano) | `ùêèùêÄ` |
| $\mathbf{EA}$                       | elementary arithmetic                               | [LO.FirstOrder.Arith.Theory.elementaryArithmetic](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Arith/EA/Basic.html#LO.FirstOrder.Arith.Theory.elementaryArithmetic) | `ùêÑùêÄ` |

### Theorem

- [Cut-elimination](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Hauptsatz.html#LO.FirstOrder.Derivation.hauptsatz)
  ```lean
  def LO.FirstOrder.Derivation.hauptsatz
      {L : LO.FirstOrder.Language}
      [(k : ‚Ñï) ‚Üí DecidableEq (LO.FirstOrder.Language.Func L k)]
      [(k : ‚Ñï) ‚Üí DecidableEq (LO.FirstOrder.Language.Rel L k)]
      {Œî : LO.FirstOrder.Sequent L} :
      ‚ä¢¬π Œî ‚Üí { d : ‚ä¢¬π Œî // LO.FirstOrder.Derivation.CutFree d }
  ```

- [Soundness theorem](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Basic/Soundness.html#LO.FirstOrder.soundness)
  ```lean
  theorem LO.FirstOrder.soundness
      {L : LO.FirstOrder.Language}
      {T : Set (LO.FirstOrder.Sentence L)}
      {œÉ : LO.FirstOrder.Sentence L} :
      T ‚ä¢ œÉ ‚Üí T ‚ä® œÉ
  ```

- [Completeness theorem](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Completeness/Completeness.html#LO.FirstOrder.completeness)
  ```lean
  noncomputable def LO.FirstOrder.completeness
      {L : LO.FirstOrder.Language}
      {T : LO.FirstOrder.Theory L}
      {œÉ : LO.FirstOrder.Sentence L} :
      T ‚ä® œÉ ‚Üí T ‚ä¢ œÉ
  ```

- [G√∂del's first incompleteness theorem](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Incompleteness/FirstIncompleteness.html#LO.FirstOrder.Arith.first_incompleteness)
  ```lean
  theorem LO.FirstOrder.Arith.first_incompleteness
      (T : LO.FirstOrder.Theory ‚Ñí‚Çí·µ£)
      [DecidablePred T]
      [ùêÑùêê ‚âº T]
      [ùêèùêÄ‚Åª ‚âº T]
      [LO.FirstOrder.Arith.SigmaOneSound T]
      [LO.FirstOrder.Theory.Computable T] :
      ¬¨LO.System.Complete T
  ```
  - [undecidable sentence](https://iehality.github.io/lean4-logic/Logic/FirstOrder/Incompleteness/FirstIncompleteness.html#LO.FirstOrder.Arith.undecidable)
    ```lean
    theorem LO.FirstOrder.Arith.undecidable
        (T : LO.FirstOrder.Theory ‚Ñí‚Çí·µ£)
        [DecidablePred T]
        [ùêÑùêê ‚âº T]
        [ùêèùêÄ‚Åª ‚âº T]
        [LO.FirstOrder.Arith.SigmaOneSound T]
        [LO.FirstOrder.Theory.Computable T] :
        T ‚ä¨ LO.FirstOrder.Arith.FirstIncompleteness.undecidable T ‚àß
        T ‚ä¨ ~LO.FirstOrder.Arith.FirstIncompleteness.undecidable T
    ```

## Standard Modal Logic

Assigned to: [@SnO2WMaN](https://github.com/SnO2WMaN)

As a general term for various modal logics commonly known as $\bf K$, $\bf S4$, etc., we refer to the logic defined on a language that includes the modal operators $\Box$ (Box) and $\Diamond$ (Diamond), where $\Diamond$ is defined as the dual of $\Box$ (i.e., $\Diamond \varphi \equiv \lnot\Box\lnot \varphi$), as *Standard Modal Logic*[^remark_standard_modal_logic].

[^remark_standard_modal_logic]: This term is probably not usual. We introducing for convenience in naming and organizing within our formalization.

> [!NOTE]
> Be cautious similar notations for different concepts.
> We use $\TeX$ notation for concept that unrelated to our formalization, and code block \`\` for related our formalization.
> - $\sf K$ (\`\sf K`\) is axiom schema unrelated to formalization.
> - $\bf K$ (\`\bf K\`) is logic urelated to formalization.
> - `ùóû` (Mathematical Sans-Serif Bold) is `AxiomSet` in formalization.
> - `ùêä` (Mathematical Bold Capital) is `DeductionParameter` in formalization.

### Axioms

As an example, describe about axiom $\sf K$. Other axioms such as $\sf T$ and $\sf 4$ follow the same manner.

```lean
-- Axiom schema
abbrev System.Axioms.K (p q : F) := ‚ñ°(p ‚ü∂ q) ‚ü∂ ‚ñ°p ‚ü∂ ‚ñ°q

abbrev Modal.Standard.AxiomSet (Œ± : Type*) := Set (Modal.Standard.Formula Œ±)

abbrev Modal.Standard.AxiomSet.K : AxiomSet Œ± := { System.Axioms.K p q | (p) (q) }

notation "ùóû" => Modal.Standard.AxiomSet.K
```

### Deduction System

Our Hilbert-style deduction system for modal logic is designed to take parameters.
These parameters are as follows.

```lean
structure DeductionParameter (Œ±) where
  axiomSet : AxiomSet Œ±
  nec : Bool
```

- `axiomSet` is set of formula (aximos), For example, `ùóû`, `ùóû ‚à™ ùóß ‚à™ ùü∞`.
- `nec` is flag to contain necessitation rule.

The parameter is called _Normal_ if `axiomSet` includes `ùóû` and `nec` is `true`.

In this formalization, logics that we usually refer to as $\bf K$, $\bf S4$, etc. is characterized by deduction parameter.

### Kripke Semantics

### Geach Axioms

### Theorems

#### Soundness for Kripke Semantics

Let deduction system of `ùìì` has necessitation. If `ùìì ‚ä¢! p` then `p` is valid on every frame in `ùîΩ(Ax(ùìì))`.

```lean
instance {ùìì : DeductionParameter Œ±} [HasNec ùìì] : Sound ùìì ùîΩ(Ax(ùìì))
```

#### Consistency of Deduction System via Kripke Semantics

From soundness theorem, if `ùîΩ(Ax(ùìì))` is nonempty, deduction system of `ùìì` is consistent (i.e. not every formula is provable in `ùìì`).

```lean
instance [FrameClass.IsNonempty ùîΩ(Ax(L))] : System.Consistent L
```

It is immediately apparent, frameclass of `ùîΩ(Ax(ùêä))` is nonempty, thus `ùêä` is consistent.

```lean
instance : FrameClass.IsNonempty ùîΩ(Ax(ùêä))

instance : System.Consistent ùêä
```

Futhermore, if `ùìì` is Geach logic, then its frameclass is nonempty, thus it is consistent.

```lean
instance [ùìì.IsGeach] : FrameClass.IsNonempty ùîΩ(Ax(ùìì))

instance [ùìì.IsGeach] : System.Consistent ùìì
```

#### Completeness for Kripke Semantics

Proof of Kripke Completeness using the usual way with Canonical frames and models.

If every axioms in `Ax(ùìì)` is valid in Canonical frame of `ùìì`, `ùìì` is called _Canonical_.

```
class Canonical (ùìì : DeductionParameter Œ±) [Inhabited (MCT ùìì)] where
  realize : (CanonicalFrame ùìì) ‚äß* Ax(ùìì)
```

If `ùìì` is canonical and consistent, then `ùìì` is complete for `ùîΩ(Ax(ùìì))`.

```
instance [System.Consistent ùìì] [Canonical ùìì] : Complete ùìì ùîΩ(Ax(ùìì))
```

Immediately apparent that `ùêä` is canonical and `ùêä` is consistent mentioned above, then `ùêä` is complete.

```
instance : Canonical ùêä

instance : Complete ùêä ùîΩ(Ax(ùêä))
```

Futhermore, if `ùìì` is Geach logic, then `ùìì` is canonical, thus it is complete.

```lean
instance [ùìì.IsGeach] : Canonical ùìì

instance [ùìì.IsGeach] : Complete ùìì ùîΩ(Ax(ùìì))
```

#### Strength between Modal Logics

It is immediately apparent that, when `ùìì‚ÇÅ‚Äã` and `ùìì‚ÇÇ` are same inference rule[^strength_between_modal_logics_1], the logical strength between `ùìì‚ÇÅ` and `ùìì‚ÇÇ` is determined by the subset of their axiom set.

[^strength_between_modal_logics_1]: It is permissible that `ùìì‚ÇÇ` has all inference rule of `ùìì‚ÇÅ‚Äã`.

```lean
lemma reducible_of_subset (hNec : L‚ÇÅ.nec ‚â§ L‚ÇÇ.nec) (hAx : Ax(L‚ÇÅ) ‚äÜ Ax(L‚ÇÇ)) : L‚ÇÅ ‚â§‚Çõ L‚ÇÇ := by

lemma reducible_K_KT : ùêä ‚â§‚Çõ ùêäùêì
```

However, even without the subset of axiomset, it is possible to analyze the strength of logic via Kripke semantics, specifically by analyzing the properties of frames defined by the axioms. For example, since seriality follows from reflexivity, $\bf KT$ is stronger than $\bf KD$ ($\sf K \cup D \not\sube K \cup T$).

```lean
lemma reducible_of_definability
  [Sound ùìì‚ÇÅ‚Äã ùîΩ(Ax(ùìì‚ÇÅ‚Äã))] [Complete ùìì‚ÇÇ ùîΩ(Ax(ùìì‚ÇÇ))]
  [Definability Ax(ùìì‚ÇÅ‚Äã) P‚ÇÅ] [Definability Ax(ùìì‚ÇÇ) P‚ÇÇ]
  (hs : ‚àÄ {F : Frame}, P‚ÇÇ F ‚Üí P‚ÇÅ F)
  : ùìì‚ÇÅ‚Äã ‚â§‚Çõ ùìì‚ÇÇ

theorem reducible_KD_KT : ùêäùêÉ ‚â§‚Çõ ùêäùêì
```

By same argument, the equivalence of provability between logics can be analyzed. $\bf S5$ is equivalent to $\bf KT4B$ ($\sf K \cup T \cup 5 \neq K \cup T \cup 4 \cup B$).

```lean
lemma equiv_of_iff_definability
  [Sound ùìì‚ÇÅ‚Äã ùîΩ(Ax(ùìì‚ÇÅ‚Äã))] [Sound ùìì‚ÇÇ ùîΩ(Ax(ùìì‚ÇÇ))]
  [Complete ùìì‚ÇÅ‚Äã ùîΩ(Ax(ùìì‚ÇÅ‚Äã))] [Complete ùìì‚ÇÇ ùîΩ(Ax(ùìì‚ÇÇ))]
  [Definability Ax(ùìì‚ÇÅ‚Äã) P‚ÇÅ] [Definability Ax(ùìì‚ÇÇ) P‚ÇÇ]
  (h : ‚àÄ {F : Frame}, P‚ÇÅ F ‚Üî P‚ÇÇ F) : ùìì‚ÇÅ‚Äã =‚Çõ ùìì‚ÇÇ

theorem equiv_S5_KT4B : ùêíùüì =‚Çõ ùêäùêìùüíùêÅ
```

#### Modal Companion

Through a translation called _G√∂del Translation_ from propositional logic formula to modal logic formula, intuitionistic logic $\bf Int$ can be embedded into $\bf S4$. (This theorem is known as _G√∂del-McKensey-Tarski Theorem_.)

```lean
def GoedelTranslation : Superintuitionistic.Formula Œ± ‚Üí Formula Œ±

postfix:75 "·µç" => GoedelTranslation

theorem provable_efq_iff_provable_S4
  {p : Superintuitionistic.Formula Œ±}
  : ùêàùêßùê≠ ‚ä¢! p ‚Üî ùêíùüí ‚ä¢! p·µç
```

The generalized version of this relationship is called _Modal Companion_. $(\bf Int,S4)$ has modal companion.

```lean
class ModalCompanion (iùìì : Superintuitionistic.DeductionParameter Œ±) (mùìì : Modal.Standard.DeductionParameter Œ±) where
  companion : ‚àÄ {p : Superintuitionistic.Formula Œ±}, iùìì ‚ä¢! p ‚Üî mùìì ‚ä¢! p·µç

instance : ModalCompanion ùêàùêßùê≠ ùêíùüí
```

#### Undefinability of Frame Property

There is no axiom set that irreflexivity of frame defines. In other words, as long as the inference rule of `ùìì` is only necessitation, no matter what axiom sets of `ùìì` has, deduction system of `ùìì` cannot be represent irreflexive Kripke frame.

```
theorem Kripke.undefinability_irreflexive : ¬¨‚àÉ (Ax : AxiomSet Œ±), (‚àÄ {F : Frame}, (Irreflexive F.Rel) ‚Üî F ‚äß* Ax)
```

## References
- J. Han, F. van Doorn, A formalization of forcing and the unprovability of the continuum hypothesis
- W. Pohlers, Proof Theory: The First Step into Impredicativity
- P. H√°jek, P. Pudl√°k, Metamathematics of First-Order Arithmetic
- R. Kaye, Models of Peano arithmetic
- Áî∞‰∏≠ ‰∏Ä‰πã, „Ç≤„Éº„Éá„É´„Å®20‰∏ñÁ¥Ä„ÅÆË´ñÁêÜÂ≠¶
- ËèäÊ±† Ë™† (Á∑®ËÄÖ), „ÄéÊï∞Â≠¶„Å´„Åä„Åë„ÇãË®ºÊòé„Å®ÁúüÁêÜ ‚îÄ ÊßòÁõ∏Ë´ñÁêÜ„Å®Êï∞Â≠¶Âü∫Á§éË´ñ„Äè
- P. Blackburn, M. de Rijke, Y. Venema, "Modal Logic"
- Open Logic Project, ["The Open Logic Text"](https://builds.openlogicproject.org/)
- R. Hakli, S. Negri, "Does the deduction theorem fail for modal logic?"
- G. Boolos, "The Logic of Provability"
- Huayu Guo, Dongheng Chen, Bruno Bentzen, _"Verified completeness in Henkin-style for intuitionistic propositional logic"_
  - https://arxiv.org/abs/2310.01916
  - https://github.com/bbentzen/ipl
